unit Registration;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.Menus, ComObj, ActiveX,
  Data.DB, Vcl.Grids, Vcl.DBGrids, Data.Win.ADODB, Vcl.ExtCtrls, iniFiles, DateUtils, ExcelXP;

type
  TForm1 = class(TForm)

    Label1: TLabel;
    ComboBox1: TComboBox;
    Edit1: TEdit;
    Label2: TLabel;
    Label3: TLabel;
    Edit2: TEdit;
    Label4: TLabel;
    Edit3: TEdit;
    Label5: TLabel;
    Edit4: TEdit;
    Label6: TLabel;
    Edit5: TEdit;
    ComboBox2: TComboBox;
    Button1: TButton;
    CheckBox1: TCheckBox;
    Button2: TButton;
    ADOConnection1: TADOConnection;
    ADOQuery1: TADOQuery;
    DataSource1: TDataSource;
    CheckBox2: TCheckBox;
    CheckBox3: TCheckBox;
    DBGrid1: TDBGrid;
    MainMenu1: TMainMenu;
    N1: TMenuItem;
    N2: TMenuItem;
    Button3: TButton;
    N3: TMenuItem;
    SaveDialog1: TSaveDialog;
    procedure ComboBox1Click(Sender: TObject);
    procedure ComboBox2Click(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure Button1Click(Sender: TObject);
    procedure CheckBox1Click(Sender: TObject);
    procedure DBGrid1DblClick(Sender: TObject);
    procedure Button2Click(Sender: TObject);
    procedure Edit1KeyPress(Sender: TObject; var Key: Char);
    procedure Edit2KeyPress(Sender: TObject; var Key: Char);
    procedure Edit3KeyPress(Sender: TObject; var Key: Char);
    procedure Edit4KeyPress(Sender: TObject; var Key: Char);
    procedure Edit5KeyPress(Sender: TObject; var Key: Char);
    procedure CheckBox3Click(Sender: TObject);
    procedure CheckBox2Click(Sender: TObject);
    procedure DBGrid1KeyPress(Sender: TObject; var Key: Char);
    procedure N2Click(Sender: TObject);
    procedure Button3Click(Sender: TObject);
    procedure DBGrid1Enter(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);
    procedure N3Click(Sender: TObject);
//    procedure DsMoveTo(dts: TDataSet; index: integer);
//    function DSNotEmpty(inSet: TDataSet): boolean;





  //  function GetUserFromWindows: string;
  private
    { Private declarations }
 // Procedure MainConnecting();
 // Function TestConnection(): Boolean;
  public
    { Public declarations }
  end;



var
  Form1: TForm1;
  ini : TIniFile;
  //Переменные для базы данных
  NameTable_Registration :string  =  'Registration';
  SHK_Svod               :string  =  '[ШК Сводного]';
  SHK_Reestr             :string  =  '[ШК Реестра]';
  SHK_Group              :string  =  '[ШК Группировки]';
  User_name              :string  =  '[Имя пользователя]';
  Type_delivery          :string  =  '[Тип доставки]';
  Service                :string  =  'Служба';
  SHK_DHL                :string  =  '[ШК DHL]';
  SHK_Doc                :string  =  '[ШК Документа]';
   { LA:= 'LA';
    LB:= 'LB';
    LI:= 'LI';
    LD:= 'LD';
    PB:= 'PB';
    LF:= 'LF';
    LRU:= '2LRU';
    WWW:= 'WWW';
  SHK_Svod, SHK_Reestr, SHK_Group, User_name, Type_delivery, Service, SHK_DHL, SHK_Doc : string;
  WWW,LA,LB,LI,LD,LF,PB,LRU : string;   }
implementation
{$R *.dfm}

Uses Rasshivka, ErrorMessage;


{Function TForm1.TestConnection(): Boolean;
var  ini: TIniFile;
ConnectionString: String;
begin
    Result:=True;                     // Если не произойдет "плохого", то функция вернет это значение
    // Подключение и считывание из файла настроек ini

    ini:=TiniFile.Create(extractfilepath(paramstr(0)) + 'Setting.ini');
    ADOConnection1.ConnectionString:=Ini.ReadString('Connect','ConnectionString','');
    ini.Free;
// Проверка, имеется ли подключение? Если да, то - сброс
      If ADOConnection1.Connected=True  then
      begin
      ADOConnection1.Connected:=False;
      // Назначение компоненту считанной из файла настроек строки подключения
      ADOConnection1.ConnectionString:=ConnectionString;
      end;
// Подключение
          Try
          ADOConnection1.Connected:=true;

          Except

          ADOConnection1.Connected:=False;     // Если неудача
          Result:=False;
          End;
end;

Procedure TForm1.MainConnecting();
var   ini: TIniFile;
      ConnectionString: String;
begin
      ini:=TiniFile.Create(extractfilepath(paramstr(0)) + 'Setting.ini');
      ConnectionString:=Ini.ReadString('Connect','ConnectionString','');
      ini.Free;
      If ADOConnection1.Connected=True  then
      begin

      ADOConnection1.Connected:=False;
      ADOConnection1.ConnectionString:=ConnectionString;
      ADOConnection1.Connected:=true;
      end;
end;            }

function Peremennie : string;
begin
    NameTable_Registration  := 'Registration';
    SHK_Svod        :=  '[ШК Сводного]';
    SHK_Reestr      :=  '[ШК Реестра]';
    SHK_Group       :=  '[ШК Группировки]';
    User_name       :=  '[Имя пользователя]';
    Type_delivery   :=  '[Тип доставки]';
    Service         :=  'Служба';
    SHK_DHL         :=  '[ШК DHL]';
    SHK_Doc         :=  '[ШК Документа]';
    LA:= 'LA';
    LB:= 'LB';
    LI:= 'LI';
    LD:= 'LD';
    PB:= 'PB';
    LF:= 'LF';
    LRU:= '2LRU';
    WWW:= 'WWW';
end;


function GetUserFromWindows: string;
var
  Name : string;
  NameLen : Dword;
begin
  NameLen := 255;
  SetLength(Name, NameLen);
  if GetUserName(PChar(Name), NameLen) then
    Result := Copy(Name,1,NameLen - 1)
  else
    Result := 'Не вышло';
end;



// Кнопка Сохранить
procedure TForm1.Button1Click(Sender: TObject);
var
              Com_box_2, EMS, KCE, Pony_Express, MAJOR, PTK, ESP_Express, Credit_Consulting :string;
              Com_box, Pisma, Kur_slujba, DHL_Paket, DHL_Koroba :string;
              WWW,LA,LB,LI,LD,LF,PB,LRU : string;
begin
       //   LA:= 'LA';
       //   LB:= 'LB';
       //   LI:= 'LI';
        //  LD:= 'LD';
       //   PB:= 'PB';
        //  LF:= 'LF';
        //  LRU:= '2LRU';
        //  WWW:= 'WWW';


          DHL_Koroba := ComboBox1.Items[0];
          DHL_Paket := ComboBox1.Items[1];
          Kur_slujba := ComboBox1.Items[2];
          Pisma := ComboBox1.Items[3];
          Com_box := ComboBox1.Items.Strings[ComboBox1.ItemIndex];

          ESP_Express  := Combobox2.Items[0];
          KCE := Combobox2.Items[1];
          MAJOR  := Combobox2.Items[2];
          EMS := Combobox2.Items[3];
          Pony_Express := Combobox2.Items[4];
          PTK   := Combobox2.Items[5];
          Credit_Consulting := Combobox2.Items[6];
          Com_box_2 := ComboBox2.Items.Strings[ComboBox2.ItemIndex];

//Ввод данных в базу -----------------------------------------------------------------------------------------------
          if (Com_box = DHL_Paket) then
          begin
                if Edit2.Text = '' then
                begin

                ShowMessage('Введите Штрих-код DHL');
                Edit2.SetFocus;

                end
                else if Edit4.Text = '' then
                     begin

                     ShowMessage('Введите № документа');
                     Edit4.SetFocus;

                     end
                     else if Edit5.Text = '' then
                          begin

                          ShowMessage('Введите Штрих-код документа');
                          Edit5.SetFocus;

                          end
                          else if  (copy(Edit5.Text, 0, 2) = LA) or (copy(Edit5.Text, 0, 2) = LB) or
                                   (copy(Edit5.Text, 0, 2) = LI) or (copy(Edit5.Text, 0, 2) = LD) or
                                   (copy(Edit5.Text, 0, 2) = PB) or (copy(Edit5.Text, 0, 2) = LF) or
                                   (copy(Edit5.Text, 0, 4) = LRU) or (copy(Edit5.Text, 0, 3) = WWW) then
                                begin

                                ShowMessage('Не правильно введен штрих-код сопроводительного документа');
                                Edit1.Enabled := False;
                                Edit2.Enabled := False;
                                Edit3.Enabled := False;
                                Edit4.Enabled := False;
                                Edit5.SetFocus;
                                Edit5.SelectAll;

                                end
                                else
                                     begin

                                     ADOQuery1.Close;
                                     ADOQuery1.SQL.Clear;
                                     ADOQuery1.SQL.ADD('SELECT [ШК Документа] FROM Registration WHERE [ШК Документа] = '+quotedstr(edit5.Text)+'');

                                     ADOQuery1.Open;

                                            if not ADOQuery1.Eof then
                                            begin

                                            ADOQuery1.Close;

                                            ADOQuery1.ExecSQL;

                                            ADOQuery1.SQL.Clear;
                                            ADOQuery1.SQL.Add('SELECT * FROM Registration ORDER BY ID DESC');
                                            ADOQuery1.Open;

                                            ShowMessage('есть');


                                            end
                                            else
                                                begin




                                                ADOQuery1.Close;




                                                ADOQuery1.SQL.Add('INSERT INTO Registration ([ШК Сводного], [ШК DHL], [ШК Реестра], [ШК Группировки], [ШК Документа], [Имя пользователя], [Тип доставки], Служба)');
                                                ADOQuery1.SQL.Add('VALUES (' + quotedstr(edit1.Text) + ',' +
                                                                               quotedstr(edit2.Text) + ',' +
                                                                               quotedstr(edit3.Text) + ',' +
                                                                               quotedstr(edit4.Text) + ',' +
                                                                               quotedstr(edit5.Text) + ',' +
                                                                               quotedstr(GetUserFromWindows) + ',' +
                                                                               quotedstr(ComboBox1.Items.Strings[ComboBox1.ItemIndex]) + ',' +
                                                                               quotedstr('DHL') + ')' );

                                                ADOQuery1.ExecSQL;
                                                ADOQuery1.SQL.Clear;
                                                ADOQuery1.SQL.Add('SELECT * FROM Registration ORDER BY ID DESC');

                                                ADOQuery1.Open;



                                                    if CheckBox3.Checked = True then
                                                    begin
                                                          Edit2.Enabled := True;
                                                          Edit3.Enabled := True;
                                                          Edit4.Enabled := True;

                                                         Edit2.Clear;
                                                         Edit3.Clear;
                                                         Edit5.Clear;
                                                         Edit2.SetFocus;
                                                     end
                                                    else
                                                        begin
                                                          Edit1.Enabled := True;
                                                          Edit2.Enabled := True;
                                                          Edit3.Enabled := True;
                                                          Edit4.Enabled := True;


                                                            Edit1.Clear;
                                                            Edit2.Clear;
                                                            Edit3.Clear;
                                                            Edit5.Clear;
                                                            Edit2.SetFocus;
                                                        end;



                                                end;
                                     end;

          end;

// Работа с MAJOR
                if (Com_box_2 = MAJOR) then
                begin

                          if Edit2.Text = '' then
                          begin

                               ShowMessage('Введите Штрих-код DHL');
                               Edit2.SetFocus;

                          end;

                          if Edit4.Text = '' then
                          begin

                               ShowMessage('Введите № документа');
                               Edit4.SetFocus;

                          end;

                          if Edit5.Text = '' then
                          begin
                                ShowMessage('Введите Штрих-код документа');
                                Edit5.SetFocus;
                          end
                          else
                          if  (copy(Edit5.Text, 0, 2) = LA) or (copy(Edit5.Text, 0, 2) = LB) or
                              (copy(Edit5.Text, 0, 2) = LI) or (copy(Edit5.Text, 0, 2) = LD) or
                              (copy(Edit5.Text, 0, 2) = PB) or (copy(Edit5.Text, 0, 2) = LF) or
                              (copy(Edit5.Text, 0, 4) = LRU) or (copy(Edit5.Text, 0, 3) = WWW) then

                          begin
                                        ShowMessage('Не правильно введен штрих-код сопроводительного документа');
                                        Edit5.SetFocus;
                                        Edit5.SelectAll;
                           end
                          else
                             begin
                                    ADOQuery1.Close;
                                    ADOQuery1.SQL.Clear;
                                    ADOQuery1.SQL.ADD('SELECT [ШК Документа] FROM Registration WHERE [ШК Документа] = '+quotedstr(edit5.Text)+'');

                                    ADOQuery1.Open;

                                    if not ADOQuery1.Eof then
                                    begin

                                          ADOQuery1.Close;

                                          ADOQuery1.ExecSQL;

                                          ADOQuery1.SQL.Clear;
                                          ADOQuery1.SQL.Add('SELECT * FROM Registration ORDER BY ID DESC');
                                          ADOQuery1.Open;

                                          ShowMessage('есть');


                                    end
                                    else
                                    begin




                                     ADOQuery1.Close;




                                    ADOQuery1.SQL.Add('INSERT INTO Registration ([ШК Сводного], [ШК DHL], [ШК Реестра], [ШК Группировки], [ШК Документа], [Имя пользователя], [Тип доставки], Служба)');
                                    ADOQuery1.SQL.Add('VALUES (' + quotedstr(edit1.Text) + ',' +
                                                                   quotedstr(edit2.Text) + ',' +
                                                                   quotedstr(edit3.Text) + ',' +
                                                                   quotedstr(edit4.Text) + ',' +
                                                                   quotedstr(edit5.Text) + ',' +
                                                                   quotedstr(GetUserFromWindows) + ',' +
                                                                   quotedstr(ComboBox1.Items.Strings[ComboBox1.ItemIndex]) + ',' +
                                                                   quotedstr('MAJOR') + ')' );

                                    ADOQuery1.ExecSQL;
                                    ADOQuery1.SQL.Clear;
                                    ADOQuery1.SQL.Add('SELECT * FROM Registration ORDER BY ID DESC');

                                    ADOQuery1.Open;


                                      if CheckBox3.Checked = True then
                                      begin
                                           Edit2.Clear;
                                           Edit3.Clear;
                                           Edit5.Clear;
                                           Edit2.SetFocus;
                                       end
                                      else
                                          begin
                                              Edit1.Clear;
                                              Edit2.Clear;
                                              Edit3.Clear;
                                              Edit5.Clear;
                                              Edit2.SetFocus;
                                          end;



                                    end;
                          end;

                end;
// Работа с письмами
                if (Com_box = Pisma) then
                  begin
                        if Edit4.Text = '' then
                        begin
                             ShowMessage('Введите № документа');
                             Edit4.SetFocus;
                        end;

                        if Edit5.Text = '' then
                        begin
                              ShowMessage('Введите Штрих-код документа');
                              Edit5.SetFocus;
                        end
                        else
                        if  (copy(Edit5.Text, 0, 2) = LA) or (copy(Edit5.Text, 0, 2) = LB) or
                            (copy(Edit5.Text, 0, 2) = LI) or (copy(Edit5.Text, 0, 2) = LD) or
                            (copy(Edit5.Text, 0, 2) = PB) or (copy(Edit5.Text, 0, 2) = LF) or
                            (copy(Edit5.Text, 0, 4) = LRU) or (copy(Edit5.Text, 0, 3) = WWW) then

                          begin
                                        ShowMessage('Не правильно введен штрих-код сопроводительного документа');
                                        Edit5.SetFocus;
                                        Edit5.SelectAll;
                           end
                        else
                               begin
                                    ADOQuery1.Close;

                                    ADOQuery1.SQL.Clear;
                                    ADOQuery1.SQL.ADD('SELECT [ШК Документа] FROM Registration WHERE [ШК Документа] = '+quotedstr(edit5.Text)+'');
                                    ADOQuery1.Open;

                                    if not ADOQuery1.Eof then
                                    begin

                                    ADOQuery1.Close;

                                    ADOQuery1.ExecSQL;

                                    ADOQuery1.SQL.Clear;
                                    ADOQuery1.SQL.Add('SELECT * FROM Registration ORDER BY ID DESC');
                                    ADOQuery1.Open;

                                    ShowMessage('есть');


                                    end
                                    else
                                        begin


                                        ADOQuery1.Close;

                                        ADOQuery1.SQL.Add('INSERT INTO Registration ([ШК Сводного], [ШК DHL], [ШК Реестра], [ШК Группировки], [ШК Документа], [Имя пользователя], [Тип доставки], Служба)');
                                        ADOQuery1.SQL.Add('VALUES (' + quotedstr(edit1.Text) + ',' +
                                                                       quotedstr(edit2.Text) + ',' +
                                                                       quotedstr(edit3.Text) + ',' +
                                                                       quotedstr(edit4.Text) + ',' +
                                                                       quotedstr(edit5.Text) + ',' +
                                                                       quotedstr(GetUserFromWindows) + ',' +
                                                                       quotedstr(ComboBox1.Items.Strings[ComboBox1.ItemIndex]) + ',' +
                                                                       quotedstr('Письма') + ')' );
                                        ADOQuery1.ExecSQL;
                                        ADOQuery1.SQL.Clear;
                                        ADOQuery1.SQL.Add('SELECT * FROM Registration ORDER BY ID DESC');

                                        ADOQuery1.Open;

                                        Edit4.Clear;
                                        Edit5.Clear;

                                        Edit4.SetFocus;
                                        end;
                               end;
                  end;
// Работа с Коробами
                if (Com_box = DHL_Koroba) then
                begin

                        if Edit2.Text = '' then
                        begin

                             ShowMessage('Введите Штрих-код DHL');
                             Edit2.SetFocus;

                        end;

                        if Edit4.Text = '' then
                        begin

                             ShowMessage('Введите № документа');
                             Edit4.SetFocus;

                        end;

                        if Edit5.Text = '' then
                        begin
                              ShowMessage('Введите Штрих-код документа');
                              Edit5.SetFocus;
                        end
                        else
                        if  (copy(Edit5.Text, 0, 2) = LA) or (copy(Edit5.Text, 0, 2) = LB) or
                            (copy(Edit5.Text, 0, 2) = LI) or (copy(Edit5.Text, 0, 2) = LD) or
                            (copy(Edit5.Text, 0, 2) = PB) or (copy(Edit5.Text, 0, 2) = LF) or
                            (copy(Edit5.Text, 0, 4) = LRU) or (copy(Edit5.Text, 0, 3) = WWW) then

                          begin
                                        ShowMessage('Не правильно введен штрих-код сопроводительного документа');
                                        Edit5.SetFocus;
                                        Edit5.SelectAll;
                           end
                        else
                         begin
                              ADOQuery1.Close;

                              ADOQuery1.SQL.Clear;
                              ADOQuery1.SQL.ADD('SELECT [ШК Документа] FROM Registration WHERE [ШК Документа] = '+quotedstr(edit5.Text)+'');
                              ADOQuery1.Open;

                              if not ADOQuery1.Eof then
                              begin

                              ADOQuery1.Close;

                              ADOQuery1.ExecSQL;

                              ADOQuery1.SQL.Clear;
                              ADOQuery1.SQL.Add('SELECT * FROM Registration ORDER BY ID DESC');
                              ADOQuery1.Open;

                              ShowMessage('есть');


                              end
                              else
                                  begin


                                  ADOQuery1.Close;

                                  ADOQuery1.SQL.Add('INSERT INTO Registration ([ШК Сводного], [ШК DHL], [ШК Реестра], [ШК Группировки], [ШК Документа], [Имя пользователя], [Тип доставки], Служба)');
                                  ADOQuery1.SQL.Add('VALUES (' + quotedstr(edit1.Text) + ',' +
                                                                 quotedstr(edit2.Text) + ',' +
                                                                 quotedstr(edit3.Text) + ',' +
                                                                 quotedstr(edit4.Text) + ',' +
                                                                 quotedstr(edit5.Text) + ',' +
                                                                 quotedstr(GetUserFromWindows) + ',' +
                                                                 quotedstr(ComboBox1.Items.Strings[ComboBox1.ItemIndex]) + ',' +
                                                                 quotedstr('DHL') + ')' );
                                  ADOQuery1.ExecSQL;
                                  ADOQuery1.SQL.Clear;
                                  ADOQuery1.SQL.Add('SELECT * FROM Registration ORDER BY ID DESC');

                                  ADOQuery1.Open;

                                  Edit4.Clear;
                                  Edit5.Clear;

                                  Edit4.SetFocus;
                                 end;
                         end;
                end;


                if   (Com_box_2 = KCE)  or (Com_box_2 = ESP_Express)   or
                     (Com_box_2 = Pony_Express) or (Com_box_2 = PTK)  or (Com_box_2 = Credit_Consulting) then
                  begin

                        if Edit1.Text = '' then
                        begin

                             ShowMessage('Введите Штрих-код сопроводительного короба');
                             Edit1.SetFocus;
                        end;

                        if Edit4.Text = '' then
                        begin

                             ShowMessage('Введите № документа');
                             Edit4.SetFocus;
                        end;

                        if Edit5.Text = '' then
                        begin

                              ShowMessage('Введите Штрих-код документа');
                              Edit5.SetFocus;
                        end
                        else
                        if  (copy(Edit5.Text, 0, 2) = LA) or (copy(Edit5.Text, 0, 2) = LB) or
                            (copy(Edit5.Text, 0, 2) = LI) or (copy(Edit5.Text, 0, 2) = LD) or
                            (copy(Edit5.Text, 0, 2) = PB) or (copy(Edit5.Text, 0, 2) = LF) or
                            (copy(Edit5.Text, 0, 4) = LRU) or (copy(Edit5.Text, 0, 3) = WWW) then

                          begin
                                        ShowMessage('Не правильно введен штрих-код сопроводительного документа');
                                        Edit5.SetFocus;
                                        Edit5.SelectAll;
                           end
                        else
                         begin
                            ADOQuery1.Close;

                            ADOQuery1.SQL.Clear;
                            ADOQuery1.SQL.ADD('SELECT [ШК Документа] FROM Registration WHERE [ШК Документа] = '+quotedstr(edit5.Text)+'');
                            ADOQuery1.Open;

                            if not ADOQuery1.Eof then
                            begin

                            ADOQuery1.Close;

                            ADOQuery1.ExecSQL;

                            ADOQuery1.SQL.Clear;
                            ADOQuery1.SQL.Add('SELECT * FROM Registration ORDER BY ID DESC');
                            ADOQuery1.Open;

                            ShowMessage('есть');


                            end
                            else
                                begin
                                ADOQuery1.Close;
                                ADOQuery1.SQL.Add('INSERT INTO Registration ([ШК Сводного], [ШК DHL], [ШК Реестра], [ШК Группировки], [ШК Документа], [Имя пользователя], [Тип доставки], Служба)');
                                ADOQuery1.SQL.Add('VALUES (' + quotedstr(edit1.Text) + ',' +
                                                               quotedstr(edit2.Text) + ',' +
                                                               quotedstr(edit3.Text) + ',' +
                                                               quotedstr(edit4.Text) + ',' +
                                                               quotedstr(edit5.Text) + ',' +
                                                               quotedstr(GetUserFromWindows) + ',' +
                                                               quotedstr(ComboBox1.Items.Strings[ComboBox1.ItemIndex]) + ',' +
                                                               quotedstr(ComboBox2.Items.Strings[ComboBox2.ItemIndex]) + ')' );
                                ADOQuery1.ExecSQL;
                                ADOQuery1.SQL.Clear;
                                ADOQuery1.SQL.Add('SELECT * FROM Registration ORDER BY ID DESC');

                                ADOQuery1.Open;

                                Edit1.Clear;
                                Edit4.Clear;
                                Edit5.Clear;

                                Edit1.SetFocus;
                                end;
                         end;

                  end;

                if (Com_box_2 = EMS) then
                begin
                        if Edit1.Text = '' then
                        begin

                             ShowMessage('Введите Штрих-код сопроводительного короба');
                             Edit1.SetFocus;
                        end;

                        if Edit4.Text = '' then
                        begin

                             ShowMessage('Введите № документа');
                             Edit4.SetFocus;
                        end;

                        if Edit5.Text = '' then
                        begin

                              ShowMessage('Введите Штрих-код документа');
                              Edit5.SetFocus;
                        end
                        else
                        if  (copy(Edit5.Text, 0, 2) = LA) or (copy(Edit5.Text, 0, 2) = LB) or
                            (copy(Edit5.Text, 0, 2) = LI) or (copy(Edit5.Text, 0, 2) = LD) or
                            (copy(Edit5.Text, 0, 2) = PB) or (copy(Edit5.Text, 0, 2) = LF) or
                            (copy(Edit5.Text, 0, 4) = LRU) or (copy(Edit5.Text, 0, 3) = WWW) then

                          begin
                                        ShowMessage('Не правильно введен штрих-код сопроводительного документа');
                                        Edit5.SetFocus;
                                        Edit5.SelectAll;
                           end
                        else
                         begin
                            ADOQuery1.Close;

                            ADOQuery1.SQL.Clear;
                            ADOQuery1.SQL.ADD('SELECT [ШК Документа] FROM Registration WHERE [ШК Документа] = '+quotedstr(edit5.Text)+'');
                            ADOQuery1.Open;

                            if not ADOQuery1.Eof then
                            begin

                            ADOQuery1.Close;

                            ADOQuery1.ExecSQL;

                            ADOQuery1.SQL.Clear;
                            ADOQuery1.SQL.Add('SELECT * FROM Registration ORDER BY ID DESC');
                            ADOQuery1.Open;

                            ShowMessage('есть');


                            end
                            else
                                begin
                                ADOQuery1.Close;

                                ADOQuery1.SQL.Add('INSERT INTO Registration ([ШК Сводного], [ШК DHL], [ШК Реестра], [ШК Группировки], [ШК Документа], [Имя пользователя], [Тип доставки], Служба)');
                                ADOQuery1.SQL.Add('VALUES (' + quotedstr(edit1.Text) + ',' +
                                                               quotedstr(edit2.Text) + ',' +
                                                               quotedstr(edit3.Text) + ',' +
                                                               quotedstr(edit4.Text) + ',' +
                                                               quotedstr(edit5.Text) + ',' +
                                                               quotedstr(GetUserFromWindows) + ',' +
                                                               quotedstr(ComboBox1.Items.Strings[ComboBox1.ItemIndex]) + ',' +
                                                               quotedstr(ComboBox2.Items.Strings[ComboBox2.ItemIndex]) + ')' );
                                ADOQuery1.ExecSQL;
                                ADOQuery1.SQL.Clear;
                                ADOQuery1.SQL.Add('SELECT * FROM Registration ORDER BY ID DESC');

                                ADOQuery1.Open;

                                Edit1.Clear;
                                Edit3.Clear;
                                Edit4.Clear;
                                Edit5.Clear;

                                Edit1.SetFocus;
                                end;
                         end;

                end;
//------------------------------------------------------------------------------------------------------------------

               //Появление кнопки "сохранить" при условии, если не стоит галочка на "Автосохранение" и в поле № док-та пусто или что-то есть
                if (CheckBox1.Checked = False) and ((Edit5.Text = '') or (Edit5.Text <> '')) then
                  begin
                        button1.Visible := True;
                  end;


end;


//Кнопка Удалить запись
procedure TForm1.Button2Click(Sender: TObject);
    var
        buttonSelected : Integer;
        beta : integer;
begin
        beta := ADOQuery1.FieldByName('ID').Value ;
        buttonSelected := MessageDlg('Вы уверены, что хотите удалить запись ID ='+ IntToStr(beta) +'?',mtCustom, mbOKCancel, 0);

            if buttonSelected = mrOK  then
              begin
                        DBGrid1.DataSource.DataSet.Delete;
              end;
           // else if buttonSelected = mrCancel then ShowMessage('Была нажата Cancel');



end;

procedure TForm1.Button3Click(Sender: TObject);

begin
        Form3.ShowModal;
        Form3.Button1.Enabled := False;
        Form3.CheckBox1.Checked := False;
        Form3.Label1.Caption := 'Вы ошибочно ввели:' +  '';
end;

//Нажатие "Автосохранение"
procedure TForm1.CheckBox1Click(Sender: TObject);

begin
          if (CheckBox1.Checked = True) and ((Edit5.Text <> '') or (Edit5.Text = '')) then
            begin
                  button1.Visible := False
            end

end;


procedure TForm1.CheckBox2Click(Sender: TObject);
begin

        if (checkBox2.Checked = True) then
          begin
              Edit3.Enabled := False;
              Edit3.Text := '0';
              Edit4.SetFocus;
          end;


        if (Edit4.Text <> '') then
          begin
               Edit5.SetFocus;
          end;

        if checkBox2.Checked = False then
          begin
              Edit3.Enabled := True;
              Edit3.Clear;
              Edit3.SetFocus;
          end;

end;

//Если нажато "Оставить Штрих-код"
procedure TForm1.CheckBox3Click(Sender: TObject);
begin
        if checkBox3.Checked = True then
          begin
              Edit1.Enabled := False;
              Edit2.SetFocus
          end
        else
          begin
              Edit1.Enabled := True;
              Edit1.Clear;
             // Edit1.SetFocus
          end;

end;


procedure TForm1.Edit1KeyPress(Sender: TObject; var Key: Char);
var
        DHL_Koroba, Com_box : string;
        EMS, KCE, Pony_Express, MAJOR, PTK, ESP_Express, Com_box_2, Credit_Consulting :string;
        LA,LB,LI,LD,LF,PB, LRU, st : string;
        MsgBox : HWND;
begin

         LRU:= '2LRU';
         LA:= 'LA';
         LB:= 'LB';
         LI:= 'LI';
         LD:= 'LD';
         PB:= 'PB';
         LF:= 'LF';

         DHL_Koroba := ComboBox1.Items[0];
         Com_box := ComboBox1.Items.Strings[ComboBox1.ItemIndex];

         ESP_Express  := Combobox2.Items[0];
         KCE := Combobox2.Items[1];
         MAJOR  := Combobox2.Items[2];
         EMS := Combobox2.Items[3];
         Pony_Express := Combobox2.Items[4];
         PTK   := Combobox2.Items[5];
         Credit_Consulting := Combobox2.Items[6];
         Com_box_2 := ComboBox2.Items.Strings[ComboBox2.ItemIndex];
         MsgBox := FindWindow('#32770', 'Заголовок MsgBoxa');

         if   (Com_box_2 = KCE) and (Key = #13)               or
              (Com_box_2 = ESP_Express) and (Key = #13)       or
              (Com_box_2 = Pony_Express) and (Key = #13)      or
              (Com_box_2 = PTK) and (Key = #13)               or
              (Com_box_2 = Credit_Consulting) and (Key = #13) then
         begin
              key:=#0;
              Edit4.SetFocus;
         end;


         if (Com_box_2 = EMS) and (Key = #13) then
         begin
                key:=#0;

                if Edit4.Text = '' then
                begin
                      Edit4.SetFocus;
                end
                else if (CheckBox2.Checked = True) and (Edit4.Text <> '') then
                      begin
                            Edit5.SetFocus;
                      end
                      else begin
                                Edit3.SetFocus;
                           end;
         end;

          if  ((copy(Edit1.Text, 0, 2) = LA) and (Key = #13)) or ((copy(Edit1.Text, 0, 2) = LB) and (Key = #13)) or
              ((copy(Edit1.Text, 0, 2) = LI) and (Key = #13)) or ((copy(Edit1.Text, 0, 2) = LD) and (Key = #13)) or
              ((copy(Edit1.Text, 0, 2) = PB) and (Key = #13)) or ((copy(Edit1.Text, 0, 2) = LF) and (Key = #13)) or
              ((copy(Edit1.Text, 0, 4) = LRU) and (Key = #13)) then

          begin

                        key:=#0;

                     //   ShowMessage('Не правильно введен штрих-код сопроводительного документа');

                        Form3.Label1.Caption := 'Вы ошибочно ввели:' + Edit1.Text;
                        Form3.ShowModal;
                        Form3.Button1.Enabled := False;
                        Form3.CheckBox1.Checked := False;

                        Edit1.SetFocus;
                        Edit1.SelectAll;

                        Edit2.Enabled := False;
                        Edit3.Enabled := False;
                        Edit4.Enabled := False;
                        Edit5.Enabled := False;
           end
           else if (Key = #13) then
                 begin
                       Edit2.Enabled := True;
                       Edit3.Enabled := True;
                       Edit4.Enabled := True;
                       Edit5.Enabled := True;

                       key:=#0;
                       Edit2.SetFocus;
                 end;

       if (Com_box = DHL_Koroba) and (Key = #13) then
         begin
               Edit2.SetFocus;
         end;

       if (key in
           ['/','*','-','~','`','!','"','@','#','№',
            ';','$','%',':','^','?','&','(',')','_','=','\','.',
            ',','<','>',':','''','{','}','[',']','|'] ) then
       begin
                     st:= key;

                        ShowMessage('Не правильно введен штрих-код сопроводительного документа, вы ввели знак ' + st);
                        key:=#0;
                        Edit1.SetFocus;
                        Edit1.SelectAll;

       end;


end;



procedure TForm1.Edit2KeyPress(Sender: TObject; var Key: Char);
var
        LA,LB,LI,LD,LF,PB,LRU, st : string;
begin
        LRU:= '2LRU';
        LA:= 'LA';
        LB:= 'LB';
        LI:= 'LI';
        LD:= 'LD';
        PB:= 'PB';
        LF:= 'LF';

         if  ((copy(Edit2.Text, 0, 2) = LA) and (Key = #13)) or ((copy(Edit2.Text, 0, 2) = LB) and (Key = #13)) or
             ((copy(Edit2.Text, 0, 2) = LI) and (Key = #13)) or ((copy(Edit2.Text, 0, 2) = LD) and (Key = #13)) or
             ((copy(Edit2.Text, 0, 2) = PB) and (Key = #13)) or ((copy(Edit2.Text, 0, 2) = LF) and (Key = #13)) or
             ((copy(Edit2.Text, 0, 4) = LRU) and (Key = #13)) then

          begin

                        key:=#0;
                      //  ShowMessage('Не правильно введен штрих-код сопроводительного документа');
                      //  Edit2.SetFocus;
                      //  Edit2.SelectAll;

                        Form3.Label1.Caption := 'Вы ошибочно ввели:' + Edit2.Text;
                        Form3.ShowModal;
                        Form3.Button1.Enabled := False;
                        Form3.CheckBox1.Checked := False;

                        Edit2.SetFocus;
                        Edit2.SelectAll;

                        Edit1.Enabled := False;
                        Edit3.Enabled := False;
                        Edit4.Enabled := False;
                        Edit5.Enabled := False;

           end
           else if Key = #13 then
                 begin

                      Edit1.Enabled := True;
                      Edit3.Enabled := True;
                      Edit4.Enabled := True;
                      Edit5.Enabled := True;

                      key:=#0;
                      Edit3.SetFocus;
                 end;

       if (key in
           ['/','*','-','~','`','!','"','@','#','№',
            ';','$','%',':','^','?','&','(',')','_','=','\','.',
            ',','<','>',':','''','{','}','[',']','|'] ) then
       begin
                        st:= key;

                        ShowMessage('Не правильно введен штрих-код сопроводительного документа, вы ввели знак ' + st);
                        key:=#0;
                        Edit2.SetFocus;
                        Edit2.SelectAll;

       end;

        if (Key = #13) and (Edit4.Text = '') then
              begin
                key:=#0;
                Edit4.SetFocus;
              end;

        if (Key = #13) and (checkBox2.Checked = True) then
              begin
                key:=#0;
                Edit5.SetFocus;
              end;

        if Key = #13 then
         begin
              key:=#0;
              Edit3.SetFocus;
         end;
end;

procedure TForm1.Edit3KeyPress(Sender: TObject; var Key: Char);
var
        LA,LB,LI,LD,LF,PB,LRU, st : string;
begin
        LRU:= '2LRU';
        LA:= 'LA';
        LB:= 'LB';
        LI:= 'LI';
        LD:= 'LD';
        PB:= 'PB';
        LF:= 'LF';

        if  ((copy(Edit3.Text, 0, 2) = LA) and (Key = #13)) or ((copy(Edit3.Text, 0, 2) = LB) and (Key = #13)) or
            ((copy(Edit3.Text, 0, 2) = LI) and (Key = #13)) or ((copy(Edit3.Text, 0, 2) = LD) and (Key = #13)) or
            ((copy(Edit3.Text, 0, 2) = PB) and (Key = #13)) or ((copy(Edit3.Text, 0, 2) = LF) and (Key = #13)) or
            ((copy(Edit3.Text, 0, 4) = LRU) and (Key = #13)) then

          begin

                        key:=#0;
                        ShowMessage('Не правильно введен штрих-код сопроводительного документа');
                        Edit3.SetFocus;
                        Edit3.SelectAll;

           end
           else if (Edit4.Text <> '') and (Key = #13) then
                begin
                     key:=#0;
                     Edit5.SetFocus;
                end
                else  if Key = #13 then
                       begin
                            key:=#0;
                            Edit4.SetFocus;
                       end;

       if (key in
           ['/','*','-','~','`','!','"','@','#','№',
            ';','$','%',':','^','?','&','(',')','_','=','\','.',
            ',','<','>',':','''','{','}','[',']','|'] ) then
       begin
                     st:= key;

                        ShowMessage('Не правильно введен штрих-код сопроводительного документа, вы ввели знак ' + st);
                        key:=#0;
                        Edit3.SetFocus;
                        Edit3.SelectAll;

       end;

end;

procedure TForm1.Edit4KeyPress(Sender: TObject; var Key: Char);
var
        LA,LB,LI,LD,LF,PB,LRU, st : string;
begin
        LRU:= '2LRU';
        LA:= 'LA';
        LB:= 'LB';
        LI:= 'LI';
        LD:= 'LD';
        PB:= 'PB';
        LF:= 'LF';

          if  (((copy(Edit4.Text, 0, 2) <> LA) and (Key = #13)) and ((copy(Edit4.Text, 0, 2) <> LB) and (Key = #13)) and
              ((copy(Edit4.Text, 0, 2) <> LI) and (Key = #13)) and ((copy(Edit4.Text, 0, 2) <> LD) and (Key = #13)) and
              ((copy(Edit4.Text, 0, 2) <> PB) and (Key = #13)) and ((copy(Edit4.Text, 0, 2) <> LF) and (Key = #13))) or
              ((copy(Edit4.Text, 0, 4) = LRU) and (Key = #13)) then

          begin
                        ShowMessage('Не правильно введен штрих-код № группировки');
                        key:=#0;
                        Edit4.SetFocus;
                        Edit4.SelectAll;

           end
           else if Key = #13 then
                 begin
                      key:=#0;
                      Edit5.SetFocus;
                 end;

       if (key in
           ['/','*','-','~','`','!','"','@','#','№',
            ';','$','%',':','^','?','&','(',')','_','=','\','.',
            ',','<','>',':','''','{','}','[',']','|'] ) then
       begin
                        st:= key;

                        ShowMessage('Не правильно введен штрих-код сопроводительного документа, вы ввели знак ' + st);
                        key:=#0;
                        Edit4.SetFocus;
                        Edit4.SelectAll;

       end;

         if Key = #13 then
         begin
              key:=#0;
              Edit5.SetFocus;
         end;

end;


procedure TForm1.Edit5KeyPress(Sender: TObject; var Key: Char);
          var Com_box_2, EMS, KCE, Pony_Express, MAJOR, PTK, ESP_Express, Credit_Consulting :string;
              Com_box, Pisma, Kur_slujba, DHL_Paket, DHL_Koroba :string;
              WWW,st, LA,LB,LI,LD,LF,PB,LRU : string;
              i:integer;
begin
          LA:= 'LA';
          LB:= 'LB';
          LI:= 'LI';
          LD:= 'LD';
          PB:= 'PB';
          LF:= 'LF';
          LRU:= '2LRU';
          WWW:= 'WWW';

          DHL_Koroba := ComboBox1.Items[0];
          DHL_Paket := ComboBox1.Items[1];
          Kur_slujba := ComboBox1.Items[2];
          Pisma := ComboBox1.Items[3];
          Com_box := ComboBox1.Items.Strings[ComboBox1.ItemIndex];

          ESP_Express  := Combobox2.Items[0];
          KCE := Combobox2.Items[1];
          MAJOR  := Combobox2.Items[2];
          EMS := Combobox2.Items[3];
          Pony_Express := Combobox2.Items[4];
          PTK   := Combobox2.Items[5];
          Credit_Consulting := Combobox2.Items[6];
          Com_box_2 := ComboBox2.Items.Strings[ComboBox2.ItemIndex];
          LoadKeyboardLayout('00000409', KLF_ACTIVATE);


      if (CheckBox1.Checked = False) and ((Edit5.Text = '') or (Edit5.Text <> '')) then
       begin
              button1.Visible := True;
       end;




      //Проверка поля "№ документа" -------------------------------------------------------------------------------------
      if     ((Com_box = DHL_Paket) and (Key = #13))
          or ((Com_box_2 = MAJOR) and (Key = #13))
          or ((Com_box = DHL_Koroba) and (Key = #13)) then
      begin

          if Edit2.Text = '' then
          begin
               key:=#0;
               ShowMessage('Введите Штрих-код DHL');
               Edit2.SetFocus;

          end
          else  if Edit4.Text = '' then
                begin
                     key:=#0;
                     ShowMessage('Введите № Группировки');
                     Edit4.SetFocus;

                end
                else  if Edit5.Text = '' then
                      begin
                            key:=#0;
                            ShowMessage('Введите № документа');
                      end;




      end;

      if   ((Com_box = Pisma) and (Key = #13)) then
       begin
             if Edit4.Text = '' then
              begin
                   key:=#0;
                   ShowMessage('Введите № документа');
              end
              else if Edit5.Text = '' then
                    begin
                          key:=#0;
                          ShowMessage('Введите Штрих-код документа');
                    end;

       end;

       if  ((Com_box = Kur_slujba) and (Com_box_2 = KCE) and (Key = #13))               or
           ((Com_box = Kur_slujba) and (Com_box_2 = ESP_Express) and (Key = #13))       or
           ((Com_box = Kur_slujba) and (Com_box_2 = Pony_Express) and (Key = #13))      or
           ((Com_box = Kur_slujba) and (Com_box_2 = PTK) and (Key = #13))               or
           ((Com_box = Kur_slujba) and (Com_box_2 = EMS) and (Key = #13))               or
           ((Com_box = Kur_slujba) and (Com_box_2 = Credit_Consulting) and (Key = #13)) then
       begin
          if Edit1.Text = '' then
          begin
               key:=#0;
               ShowMessage('Введите Штрих-код DHL');
               Edit1.SetFocus;

          end
          else  if Edit4.Text = '' then
                begin
                     key:=#0;
                     ShowMessage('Введите № Группировки');
                     Edit4.SetFocus;

                end
                else  if Edit5.Text = '' then
                      begin
                            key:=#0;
                            ShowMessage('Введите № документа');
                      end;


       end;

        if  (((copy(Edit5.Text, 0, 2) = LA) and (Key = #13)) or ((copy(Edit5.Text, 0, 2) = LB) and (Key = #13))   or
            ((copy(Edit5.Text, 0, 2) = LI) and (Key = #13))  or ((copy(Edit5.Text, 0, 2) = LD) and (Key = #13))   or
            ((copy(Edit5.Text, 0, 2) = PB) and (Key = #13))  or ((copy(Edit5.Text, 0, 2) = LF) and (Key = #13)))  or
            ((copy(Edit5.Text, 0, 4) = LRU) and (Key = #13)) or ((copy(Edit5.Text, 0, 3) = WWW) and (Key = #13))  or
            ((Length(Edit5.Text) < 6) and (Key = #13)) then

          begin

                        key:=#0;
                        ShowMessage('Не правильно введен штрих-код сопроводительного документа');
                        Edit5.SetFocus;
                        Edit5.SelectAll;

           end;

       if (key in
           ['/','*','-','~','`','!','"','@','#','№',
            ';','$','%',':','^','?','&','(',')','_','=','\','.',
            ',','<','>',':','''','{','}','[',']','|'] ) then
       begin
                     st:= key;

                        ShowMessage('Не правильно введен штрих-код сопроводительного документа, вы ввели знак ' + st);
                        key:=#0;
                        Edit5.SetFocus;
                        Edit5.SelectAll;

       end;

    //------------------------------------------------------------------------------------------------------------------
   if (CheckBox1.Checked = True) then
   begin
      //Ввод данных в базу -----------------------------------------------------------------------------------------------
                if (Com_box = DHL_Paket) and (Key = #13) then
                  begin


                                ADOQuery1.Close;
                                ADOQuery1.SQL.Clear;
                                ADOQuery1.SQL.ADD('SELECT [ШК Документа] FROM Registration WHERE [ШК Документа] = '+quotedstr(edit5.Text)+'');

                                ADOQuery1.Open;

                                if not ADOQuery1.Eof then
                                begin

                                      ADOQuery1.Close;

                                      ADOQuery1.ExecSQL;

                                      ADOQuery1.SQL.Clear;
                                      ADOQuery1.SQL.Add('SELECT * FROM Registration WHERE [Имя пользователя] =' + quotedstr(GetUserFromWindows)+ ' AND DATEDIFF(day, [Дата регистрации], GETDATE()) = 0 ORDER BY ID DESC');
                                      ADOQuery1.Open;

                                      ShowMessage('есть');


                                end
                                else
                                begin




                                 ADOQuery1.Close;




                                ADOQuery1.SQL.Add('INSERT INTO Registration ([ШК Сводного], [ШК DHL], [ШК Реестра], [ШК Группировки], [ШК Документа], [Имя пользователя], [Тип доставки], Служба)');
                                ADOQuery1.SQL.Add('VALUES (' + quotedstr(edit1.Text) + ',' +
                                                               quotedstr(edit2.Text) + ',' +
                                                               quotedstr(edit3.Text) + ',' +
                                                               quotedstr(edit4.Text) + ',' +
                                                               quotedstr(edit5.Text) + ',' +
                                                               quotedstr(GetUserFromWindows) + ',' +
                                                               quotedstr(ComboBox1.Items.Strings[ComboBox1.ItemIndex]) + ',' +
                                                               quotedstr('DHL') + ')' );

                                ADOQuery1.ExecSQL;
                                ADOQuery1.SQL.Clear;
                                ADOQuery1.SQL.Add('SELECT * FROM Registration WHERE [Имя пользователя] =' + quotedstr(GetUserFromWindows)+ ' AND DATEDIFF(day, [Дата регистрации], GETDATE()) = 0 ORDER BY ID DESC');

                                ADOQuery1.Open;


                                  if CheckBox3.Checked = True then
                                  begin
                                       Edit2.Clear;
                                       Edit3.Clear;
                                       Edit5.Clear;
                                       Edit2.SetFocus;
                                   end
                                  else
                                      begin
                                          Edit1.Clear;
                                          Edit2.Clear;
                                          Edit3.Clear;
                                          Edit5.Clear;
                                          Edit2.SetFocus;
                                      end;



                                end;

                               Key := #0;

                  end;

// Работа с MAJOR
                if (Com_box_2 = MAJOR) and (Key = #13) then
                begin


                                ADOQuery1.Close;
                                ADOQuery1.SQL.Clear;
                                ADOQuery1.SQL.ADD('SELECT [ШК Документа] FROM Registration WHERE [ШК Документа] = '+quotedstr(edit5.Text)+'');

                                ADOQuery1.Open;

                                if not ADOQuery1.Eof then
                                begin

                                      ADOQuery1.Close;

                                      ADOQuery1.ExecSQL;

                                      ADOQuery1.SQL.Clear;
                                      ADOQuery1.SQL.Add('SELECT * FROM Registration WHERE [Имя пользователя] =' + quotedstr(GetUserFromWindows)+ ' AND DATEDIFF(day, [Дата регистрации], GETDATE()) = 0 ORDER BY ID DESC');
                                      ADOQuery1.Open;

                                      ShowMessage('есть');


                                end
                                else
                                begin




                                 ADOQuery1.Close;




                                ADOQuery1.SQL.Add('INSERT INTO Registration ([ШК Сводного], [ШК DHL], [ШК Реестра], [ШК Группировки], [ШК Документа], [Имя пользователя], [Тип доставки], Служба)');
                                ADOQuery1.SQL.Add('VALUES (' + quotedstr(edit1.Text) + ',' +
                                                               quotedstr(edit2.Text) + ',' +
                                                               quotedstr(edit3.Text) + ',' +
                                                               quotedstr(edit4.Text) + ',' +
                                                               quotedstr(edit5.Text) + ',' +
                                                               quotedstr(GetUserFromWindows) + ',' +
                                                               quotedstr(ComboBox1.Items.Strings[ComboBox1.ItemIndex]) + ',' +
                                                               quotedstr('MAJOR') + ')' );

                                ADOQuery1.ExecSQL;
                                ADOQuery1.SQL.Clear;
                                ADOQuery1.SQL.Add('SELECT * FROM Registration WHERE [Имя пользователя] =' + quotedstr(GetUserFromWindows)+ ' AND DATEDIFF(day, [Дата регистрации], GETDATE()) = 0 ORDER BY ID DESC');

                                ADOQuery1.Open;


                                  if CheckBox3.Checked = True then
                                  begin
                                       Edit2.Clear;
                                       Edit3.Clear;
                                       Edit5.Clear;
                                       Edit2.SetFocus;
                                   end
                                  else
                                      begin
                                          Edit1.Clear;
                                          Edit2.Clear;
                                          Edit3.Clear;
                                          Edit5.Clear;
                                          Edit2.SetFocus;
                                      end;



                                end;

                                key:=#0;

                end;
// Работа с письмами
                if (Com_box = Pisma) and (Key = #13) then
                  begin


                        ADOQuery1.Close;

                        ADOQuery1.SQL.Clear;
                        ADOQuery1.SQL.ADD('SELECT [ШК Документа] FROM Registration WHERE [ШК Документа] = '+quotedstr(edit5.Text)+'');
                        ADOQuery1.Open;

                        if not ADOQuery1.Eof then
                        begin

                        ADOQuery1.Close;

                        ADOQuery1.ExecSQL;

                        ADOQuery1.SQL.Clear;
                        ADOQuery1.SQL.Add('SELECT * FROM Registration WHERE [Имя пользователя] =' + quotedstr(GetUserFromWindows)+ ' AND DATEDIFF(day, [Дата регистрации], GETDATE()) = 0 ORDER BY ID DESC');
                        ADOQuery1.Open;

                        ShowMessage('есть');


                        end
                        else
                            begin


                            ADOQuery1.Close;

                            ADOQuery1.SQL.Add('INSERT INTO Registration ([ШК Сводного], [ШК DHL], [ШК Реестра], [ШК Группировки], [ШК Документа], [Имя пользователя], [Тип доставки], Служба)');
                            ADOQuery1.SQL.Add('VALUES (' + quotedstr(edit1.Text) + ',' +
                                                           quotedstr(edit2.Text) + ',' +
                                                           quotedstr(edit3.Text) + ',' +
                                                           quotedstr(edit4.Text) + ',' +
                                                           quotedstr(edit5.Text) + ',' +
                                                           quotedstr(GetUserFromWindows) + ',' +
                                                           quotedstr(ComboBox1.Items.Strings[ComboBox1.ItemIndex]) + ',' +
                                                           quotedstr('Письма') + ')' );
                            ADOQuery1.ExecSQL;
                            ADOQuery1.SQL.Clear;
                            ADOQuery1.SQL.Add('SELECT * FROM Registration WHERE [Имя пользователя] =' + quotedstr(GetUserFromWindows)+ ' AND DATEDIFF(day, [Дата регистрации], GETDATE()) = 0 ORDER BY ID DESC');

                            ADOQuery1.Open;

                            Edit4.Clear;
                            Edit5.Clear;

                            Edit4.SetFocus;
                            end;

                            key:=#0;
                  end;
// Работа с Коробами
                if (Com_box = DHL_Koroba) and (Key = #13) then
                begin
                        key:=#0;


                        ADOQuery1.Close;

                        ADOQuery1.SQL.Clear;
                        ADOQuery1.SQL.ADD('SELECT [ШК Документа] FROM Registration WHERE [ШК Документа] = '+quotedstr(edit5.Text)+'');
                        ADOQuery1.Open;
                                      //   SELECT Rasshivka.[Регистрация расшивки], Registration.[ШК Группировки] FROM Rasshivka, Registration WHERE Rasshivka.[Регистрация расшивки] = Registration.[ШК Группировки] ;
                        if not ADOQuery1.Eof then
                        begin

                        ADOQuery1.Close;

                        ADOQuery1.ExecSQL;

                        ADOQuery1.SQL.Clear;
                        ADOQuery1.SQL.Add('SELECT * FROM Registration WHERE [Имя пользователя] =' + quotedstr(GetUserFromWindows)+ ' AND DATEDIFF(day, [Дата регистрации], GETDATE()) = 0 ORDER BY ID DESC');
                        ADOQuery1.Open;

                        ShowMessage('есть');


                        end
                        else
                            begin


                            ADOQuery1.Close;

                            ADOQuery1.SQL.Add('INSERT INTO Registration ([ШК Сводного], [ШК DHL], [ШК Реестра], [ШК Группировки], [ШК Документа], [Имя пользователя], [Тип доставки], Служба)');
                            ADOQuery1.SQL.Add('VALUES (' + quotedstr(edit1.Text) + ',' +
                                                           quotedstr(edit2.Text) + ',' +
                                                           quotedstr(edit3.Text) + ',' +
                                                           quotedstr(edit4.Text) + ',' +
                                                           quotedstr(edit5.Text) + ',' +
                                                           quotedstr(GetUserFromWindows) + ',' +
                                                           quotedstr(ComboBox1.Items.Strings[ComboBox1.ItemIndex]) + ',' +
                                                           quotedstr('DHL') + ')' );
                            ADOQuery1.ExecSQL;
                            ADOQuery1.SQL.Clear;
                            ADOQuery1.SQL.Add('SELECT * FROM Registration WHERE [Имя пользователя] =' + quotedstr(GetUserFromWindows)+ ' AND DATEDIFF(day, [Дата регистрации], GETDATE()) = 0 ORDER BY ID DESC');

                            ADOQuery1.Open;

                            Edit4.Clear;
                            Edit5.Clear;

                            Edit4.SetFocus;
                            end;
                end;


                if   (Com_box_2 = KCE) and (Key = #13)         or
                     (Com_box_2 = ESP_Express) and (Key = #13)  or
                     (Com_box_2 = Pony_Express) and (Key = #13) or
                     (Com_box_2 = PTK) and (Key = #13)  or
                     (Com_box_2 = Credit_Consulting) and (Key = #13) then
                  begin

                        key:=#0;

                        ADOQuery1.Close;

                        ADOQuery1.SQL.Clear;
                        ADOQuery1.SQL.ADD('SELECT [ШК Документа] FROM Registration WHERE [ШК Документа] = '+quotedstr(edit5.Text)+'');
                        ADOQuery1.Open;

                        if not ADOQuery1.Eof then
                        begin

                        ADOQuery1.Close;

                        ADOQuery1.ExecSQL;

                        ADOQuery1.SQL.Clear;
                        ADOQuery1.SQL.Add('SELECT * FROM Registration WHERE [Имя пользователя] =' + quotedstr(GetUserFromWindows)+ ' AND DATEDIFF(day, [Дата регистрации], GETDATE()) = 0 ORDER BY ID DESC');
                        ADOQuery1.Open;

                        ShowMessage('есть');


                        end
                        else
                            begin
                            ADOQuery1.Close;

                            ADOQuery1.SQL.Add('INSERT INTO Registration ([ШК Сводного], [ШК DHL], [ШК Реестра], [ШК Группировки], [ШК Документа], [Имя пользователя], [Тип доставки], Служба)');
                            ADOQuery1.SQL.Add('VALUES (' + quotedstr(edit1.Text) + ',' +
                                                           quotedstr(edit2.Text) + ',' +
                                                           quotedstr(edit3.Text) + ',' +
                                                           quotedstr(edit4.Text) + ',' +
                                                           quotedstr(edit5.Text) + ',' +
                                                           quotedstr(GetUserFromWindows) + ',' +
                                                           quotedstr(ComboBox1.Items.Strings[ComboBox1.ItemIndex]) + ',' +
                                                           quotedstr(ComboBox2.Items.Strings[ComboBox2.ItemIndex]) + ')' );
                            ADOQuery1.ExecSQL;
                            ADOQuery1.SQL.Clear;
                            ADOQuery1.SQL.Add('SELECT * FROM Registration WHERE [Имя пользователя] =' + quotedstr(GetUserFromWindows)+ ' AND DATEDIFF(day, [Дата регистрации], GETDATE()) = 0 ORDER BY ID DESC');

                            ADOQuery1.Open;

                            Edit1.Clear;
                            Edit5.Clear;

                            Edit1.SetFocus;
                            end;

                  end;

                if (Com_box_2 = EMS) and (Key = #13) then
                begin
                        key:=#0;
                        ADOQuery1.Close;

                        ADOQuery1.SQL.Clear;
                        ADOQuery1.SQL.ADD('SELECT [ШК Документа] FROM Registration WHERE [ШК Документа] = '+quotedstr(edit5.Text)+'');
                        ADOQuery1.Open;

                        if not ADOQuery1.Eof then
                        begin

                        ADOQuery1.Close;

                        ADOQuery1.ExecSQL;

                        ADOQuery1.SQL.Clear;
                        ADOQuery1.SQL.Add('SELECT * FROM Registration WHERE [Имя пользователя] =' + quotedstr(GetUserFromWindows)+ ' AND DATEDIFF(day, [Дата регистрации], GETDATE()) = 0 ORDER BY ID DESC');
                        ADOQuery1.Open;

                        ShowMessage('есть');


                        end
                        else
                            begin
                            ADOQuery1.Close;

                            ADOQuery1.SQL.Add('INSERT INTO Registration ([ШК Сводного], [ШК DHL], [ШК Реестра], [ШК Группировки], [ШК Документа], [Имя пользователя], [Тип доставки], Служба)');
                            ADOQuery1.SQL.Add('VALUES (' + quotedstr(edit1.Text) + ',' +
                                                           quotedstr(edit2.Text) + ',' +
                                                           quotedstr(edit3.Text) + ',' +
                                                           quotedstr(edit4.Text) + ',' +
                                                           quotedstr(edit5.Text) + ',' +
                                                           quotedstr(GetUserFromWindows) + ',' +
                                                           quotedstr(ComboBox1.Items.Strings[ComboBox1.ItemIndex]) + ',' +
                                                           quotedstr(ComboBox2.Items.Strings[ComboBox2.ItemIndex]) + ')' );
                            ADOQuery1.ExecSQL;
                            ADOQuery1.SQL.Clear;
                            ADOQuery1.SQL.Add('SELECT * FROM Registration WHERE [Имя пользователя] =' + quotedstr(GetUserFromWindows)+ ' AND DATEDIFF(day, [Дата регистрации], GETDATE()) = 0 ORDER BY ID DESC');

                            ADOQuery1.Open;


                            Edit1.Clear;
                            Edit3.Clear;
                            Edit5.Clear;

                            Edit1.SetFocus;

                            end;

                end;
//------------------------------------------------------------------------------------------------------------------


   end;


end;

procedure TForm1.ComboBox1Click(Sender: TObject);
          var Com_box, Pisma, Kur_slujba, DHL_Paket, DHL_Koroba :string;
              EMS, KCE, Pony_Express, MAJOR, PTK, ESP_Express, Com_box_2, Credit_Consulting :string;
begin
          //ComboBox1 = DHL короба, DHL пакеты, Курьерская служба, Письма.
          DHL_Koroba := ComboBox1.Items[0];
          DHL_Paket := ComboBox1.Items[1];
          Kur_slujba := ComboBox1.Items[2];
          Pisma := ComboBox1.Items[3];
          Com_box := ComboBox1.Items.Strings[ComboBox1.ItemIndex];

          //ComboBox2 = ESPR Express, KCE, MAJOR, EMS, Pony Express, PTK.
          ESP_Express  := Combobox2.Items[0];
          KCE := Combobox2.Items[1];
          MAJOR  := Combobox2.Items[2];
          EMS := Combobox2.Items[3];
          Pony_Express := Combobox2.Items[4];
          PTK   := Combobox2.Items[5];
          Credit_Consulting := Combobox2.Items[6];
          Com_box_2 := ComboBox2.Items.Strings[ComboBox2.ItemIndex];

          if Com_box = DHL_Koroba then
            begin

              Edit1.Clear;
              Edit2.Clear;
              Edit3.Clear;
              Edit4.Clear;
              Edit5.Clear;

              Edit1.Visible := True;
              Edit2.Visible := True;
              Edit3.Visible := True;
              Edit4.Visible := True;
              Edit5.Visible := True;

              Label2.Visible := True;
              Label3.Visible := True;
              Label4.Visible := True;
              Label5.Visible := True;
              Label6.Visible := True;

              ComboBox2.Visible := False;

              CheckBox2.Checked := False;
              CheckBox3.Checked := False;

              CheckBox2.Visible := False;
              CheckBox3.Visible := False;
            end;

          if Com_box = DHL_Paket then
            begin

              Edit1.Clear;
              Edit2.Clear;
              Edit3.Clear;
              Edit4.Clear;
              Edit5.Clear;

              Edit1.Visible := True;
              Edit2.Visible := True;
              Edit3.Visible := True;
              Edit4.Visible := True;
              Edit5.Visible := True;

              Label2.Visible := True;
              Label3.Visible := True;
              Label4.Visible := True;
              Label5.Visible := True;
              Label6.Visible := True;

              ComboBox2.Visible := False;

              CheckBox2.Checked := False;
              CheckBox3.Checked := False;

              CheckBox2.Visible := True;
              CheckBox3.Visible := True;

            end;

          if Com_box = Kur_slujba then
            begin

              Edit1.Clear;
              Edit2.Clear;
              Edit3.Clear;
              Edit4.Clear;
              Edit5.Clear;

             // ComboBox2.ItemIndex := -1;
              ComboBox2.Visible := True;

              Edit1.Visible := False;
              Edit2.Visible := False;
              Edit3.Visible := False;
              Edit4.Visible := False;
              Edit5.Visible := False;

              Label2.Visible := False;
              Label3.Visible := False;
              Label4.Visible := False;
              Label5.Visible := False;
              Label6.Visible := False;

              CheckBox2.Visible := False;
              CheckBox3.Visible := False;

              CheckBox2.Checked := False;
              CheckBox3.Checked := False;

              if Com_box_2 = EMS then
               begin
                Edit1.Clear;
                Edit2.Clear;
                Edit3.Clear;
                Edit4.Clear;
                Edit5.Clear;

                CheckBox2.Visible := True;
                CheckBox3.Visible := False;

                Label2.Visible := True;
                Label3.Visible := False;
                Label4.Visible := True;
                Label5.Visible := True;
                Label6.Visible := True;

                Edit1.Visible := True;
                Edit2.Visible := False;
                Edit3.Visible := True;
                Edit4.Visible := True;
                Edit5.Visible := True;
               end;

               if (Com_box_2 = KCE) or (Com_box_2 = ESP_Express) or
                  (Com_box_2 = Pony_Express) or (Com_box_2 = PTK) or
                  (Com_box_2 = Credit_Consulting) then
                begin

                  Edit1.Clear;
                  Edit2.Clear;
                  Edit3.Clear;
                  Edit4.Clear;
                  Edit5.Clear;

                  Edit1.Visible := True;
                  Edit2.Visible := False;
                  Edit3.Visible := False;
                  Edit4.Visible := True;
                  Edit5.Visible := True;

                  Label2.Visible := True;
                  Label3.Visible := False;
                  Label4.Visible := False;
                  Label5.Visible := True;
                  Label6.Visible := True;

                  CheckBox2.Visible := False;
                  CheckBox3.Visible := False;
                end;

               if Com_box_2 = MAJOR then
                 begin
                   Edit1.Clear;
                   Edit2.Clear;
                   Edit3.Clear;
                   Edit4.Clear;
                   Edit5.Clear;

                   CheckBox2.Visible := True;
                   CheckBox3.Visible := True;

                   Label2.Visible := True;
                   Label3.Visible := True;
                   Label4.Visible := True;
                   Label5.Visible := True;
                   Label6.Visible := True;

                   Edit1.Visible := True;
                   Edit2.Visible := True;
                   Edit3.Visible := True;
                   Edit4.Visible := True;
                   Edit5.Visible := True;
                 end;


            end;

          if Com_box = Pisma then
            begin

              Edit1.Clear;
              Edit2.Clear;
              Edit3.Clear;
              Edit4.Clear;
              Edit5.Clear;

              ComboBox2.Visible := False;

              Edit1.Visible := False;
              Edit2.Visible := False;
              Edit3.Visible := False;
              Edit4.Visible := True;
              Edit5.Visible := True;

              Label2.Visible := False;
              Label3.Visible := False;
              Label4.Visible := False;
              Label5.Visible := True;
              Label6.Visible := True;

              CheckBox2.Checked := False;
              CheckBox3.Checked := False;

              CheckBox2.Visible := False;
              CheckBox3.Visible := False;
            end;

end;

procedure TForm1.ComboBox2Click(Sender: TObject);

          var EMS, KCE, Pony_Express, MAJOR, PTK, ESP_Express, Com_box_2, Credit_Consulting :string;
begin

          ESP_Express  := Combobox2.Items[0];
          KCE := Combobox2.Items[1];
          MAJOR  := Combobox2.Items[2];
          EMS := Combobox2.Items[3];
          Pony_Express := Combobox2.Items[4];
          PTK   := Combobox2.Items[5];
          Credit_Consulting := Combobox2.Items[6];
          Com_box_2 := ComboBox2.Items.Strings[ComboBox2.ItemIndex];



          if   Com_box_2 = EMS then

              begin

                Edit1.Clear;
                Edit2.Clear;
                Edit3.Clear;
                Edit4.Clear;
                Edit5.Clear;

                CheckBox2.Visible := True;
                CheckBox3.Visible := False;

                Label2.Visible := True;
                Label3.Visible := False;
                Label4.Visible := True;
                Label5.Visible := True;
                Label6.Visible := True;

                Edit1.Visible := True;
                Edit2.Visible := False;
                Edit3.Visible := True;
                Edit4.Visible := True;
                Edit5.Visible := True;

                CheckBox2.Checked := False;
                CheckBox3.Checked := False;

              end;

          if (Com_box_2 = KCE) or (Com_box_2 = ESP_Express) or
             (Com_box_2 = Pony_Express) or (Com_box_2 = PTK) or (Com_box_2 = Credit_Consulting) then
              begin

                Edit1.Clear;
                Edit2.Clear;
                Edit3.Clear;
                Edit4.Clear;
                Edit5.Clear;

                Edit1.Visible := True;
                Edit2.Visible := False;
                Edit3.Visible := False;
                Edit4.Visible := True;
                Edit5.Visible := True;

                Label2.Visible := True;
                Label3.Visible := False;
                Label4.Visible := False;
                Label5.Visible := True;
                Label6.Visible := True;

                CheckBox2.Checked := False;
                CheckBox3.Checked := False;

                CheckBox2.Visible := False;
                CheckBox3.Visible := False;
              end;

          if Com_box_2 = MAJOR then
            begin
                Edit1.Clear;
                Edit2.Clear;
                Edit3.Clear;
                Edit4.Clear;
                Edit5.Clear;

                CheckBox2.Visible := True;
                CheckBox3.Visible := True;

                Label2.Visible := True;
                Label3.Visible := True;
                Label4.Visible := True;
                Label5.Visible := True;
                Label6.Visible := True;

                CheckBox2.Checked := False;
                CheckBox3.Checked := False;

                Edit1.Visible := True;
                Edit2.Visible := True;
                Edit3.Visible := True;
                Edit4.Visible := True;
                Edit5.Visible := True;
            end;
end;



procedure TForm1.DBGrid1DblClick(Sender: TObject);
begin
          Button2.Visible := True;
end;

procedure TForm1.DBGrid1Enter(Sender: TObject);
begin


          if DBGrid1.DataSource.State = dsEdit then
          begin
            DBGrid1.DataSource.DataSet.Post;
            DBGrid1.EditorMode:=False;
          end;

end;

//не работает процедура для проверки дубля в таблице DBGrid № документа
procedure TForm1.DBGrid1KeyPress(Sender: TObject; var Key: Char);
var
        Check_Index, ID, pos : integer;
        s,t: string;
begin
        if (Key = #13) then
        begin
          if DBGrid1.DataSource.State in [dsEdit] then
          begin

            Key := #0;

           // DBGrid1.DataSource.DataSet.Post;
           // DBGrid1.EditorMode:=False;



                Check_Index :=  DBGrid1.SelectedIndex;

                if (Check_Index = 5) OR (Check_Index = 2) then
                begin

                  t  := DBGrid1.Fields[2].AsString;        //запоминаем ШК DHL
                  s  := DBGrid1.Fields[5].AsString;          //запоминаем ШК документа
                  ID := ADOQuery1.FieldByName('ID').Value; //номер ID запоминаем

                  pos:= ADOQuery1.RecNo;


                  ADOQuery1.Close;
                  ADOQuery1.SQL.Text := 'SELECT [ШК DHL], [ШК Документа] FROM Registration WHERE [ШК DHL] = :prm AND [ШК Документа] = :p ';

                  ADOQuery1.Parameters.ParamByName('prm').Value := t;  //запоминаем параметр [ШК DHL]
                  ADOQuery1.Parameters.ParamByName('p').Value := s;    //запоминаем параметр [ШК Документа]
                  ADOQuery1.Open;

                  if ADOQuery1.IsEmpty  then
                  begin
                        ADOQuery1.Close;

                        ADOQuery1.SQL.Add('UPDATE Registration SET [ШК DHL] = ' + t + ', [ШК Документа] =' + s + 'WHERE ID = ' + IntToStr(ID) );

                        ADOQuery1.ExecSQL;
                        ADOQuery1.SQL.Clear;
                        ADOQuery1.SQL.Add('SELECT * FROM Registration WHERE [Имя пользователя] =' + quotedstr(GetUserFromWindows)+ ' AND DATEDIFF(day, [Дата регистрации], GETDATE()) = 0 ORDER BY ID DESC');

                        ADOQuery1.Open;

                        DBGrid1.EditorMode := False;
                        ADOQuery1.RecNo := pos;
                  end
                  else
                      begin
                            ADOQuery1.Close;

                            ADOQuery1.SQL.Clear;
                            ADOQuery1.SQL.Add('SELECT * FROM RegistrationWHERE [Имя пользователя] =' + quotedstr(GetUserFromWindows)+ ' AND DATEDIFF(day, [Дата регистрации], GETDATE()) = 0 ORDER BY ID DESC');
                            ADOQuery1.Open;

                            ShowMessage('есть дубль');

                            DBGrid1.EditorMode := False;
                            ADOQuery1.RecNo := pos;
                      end;
                end
                else
                    begin
                          DBGrid1.DataSource.DataSet.Post;
                          DBGrid1.EditorMode := False;
                    end;


          end;



         end;


end;



procedure TForm1.FormClose(Sender: TObject; var Action: TCloseAction);
begin
        Form2.Memo1.Clear;
end;

procedure TForm1.FormCreate(Sender: TObject);
          var s,g,f :string;
              today : TDateTime;
begin

        ini:=Tinifile.Create(extractfilepath(paramstr(0))+'setting.ini');

        ADOConnection1.Connected:=False;
        ADOConnection1.LoginPrompt := False;
        ADOConnection1.DefaultDatabase := 'TeestDB.mdf';
        ADOConnection1.ConnectionString:= ini.ReadString('Connection','ConnStr','');
        ADOConnection1.Connected:=True;


        ADOQuery1.SQL.ADD('SELECT * FROM Registration WHERE [Имя пользователя] =' + quotedstr(GetUserFromWindows)+ {' AND DATEDIFF(day, [Дата регистрации], GETDATE()) = 0}' ORDER BY ID DESC');
        ADOQuery1.Active :=True;
        Ini.Free;

        DBGrid1.Columns[10].Visible := False;
        DBGrid1.Columns[11].Visible := False;

        ComboBox1.Style:= csDropDownList;
        ComboBox2.Style:= csDropDownList;

        Button1.Visible := False;
        Button2.Visible := False;


        Edit1.Visible := False;
        Edit2.Visible := False;
        Edit3.Visible := False;
        Edit4.Visible := False;
        Edit5.Visible := False;

        Label2.Visible := False;
        Label3.Visible := False;
        Label4.Visible := False;
        Label5.Visible := False;
        Label6.Visible := False;

        CheckBox2.Visible := False;
        CheckBox3.Visible := False;

end;






procedure TForm1.N2Click(Sender: TObject);
begin
      Form2.ShowModal;
end;




procedure TForm1.N3Click(Sender: TObject);
Var
   ExcelApp, Workbook, Range, Cell1, Cell2, ArrayData: Variant;
   BeginCol, BeginRow, j: integer;
   col, RowCount, ColCount: Integer;
   ShFile: String;
Begin
   BeginCol := 1;
   BeginRow := 2;

 // Размеры выводимого массива данных
   RowCount := ADOQuery1.RecordCount;
   ColCount := ADOQuery1.FieldDefs.Count;

 // Создание Excel
   ExcelApp := CreateOleObject('Excel.Application');

 // Отключаем реакцию Excel на события, чтобы ускорить вывод информации
   ExcelApp.Application.EnableEvents := false;

 //  Создаем Книгу (Workbook)
 //  Если заполняем шаблон, то
   Workbook := ExcelApp.WorkBooks.Add(ShFile);
   ArrayData := VarArrayCreate([1, RowCount, 1, ColCount], varVariant);

 // Заполняем массив
   ADOQuery1.DisableControls;

   //Вывод имена столбцов
   for col :=0 to 5 do

        ExcelApp.WorkBooks[1].WorkSheets[1].cells[1,col+1].value := dbgrid1.fields[col].displaylabel;

        ExcelApp.WorkBooks[1].WorkSheets[1].cells[1,col+1].value := dbgrid1.fields[8].displaylabel;


   While Not ADOQuery1.eof Do
   Begin
      // For J := 1 To ADOQuery1.FieldDefs.Count Do
      // Begin
      //    ArrayData[ADOQuery1.RecNo, J] := ADOQuery1.FieldbyName(ADOQuery1.FieldDefs.Items[j - 1].DisplayName).value;
      // End;
       For J := 1 To 6 Do
         Begin
            ArrayData[ADOQuery1.RecNo, J] := ADOQuery1.FieldbyName(ADOQuery1.FieldDefs.Items[j - 1].DisplayName).value;
         End;
       For J := 9 To ADOQuery1.FieldDefs.Count Do
         begin
          ArrayData[ADOQuery1.RecNo, 7] := ADOQuery1.FieldbyName(ADOQuery1.FieldDefs.Items[j - 1].DisplayName).value;
         end;
       ADOQuery1.Next;
   End;

   ADOQuery1.EnableControls;

 // Левая верхняя ячейка области, в которую будем выводить данные
   Cell1 := WorkBook.WorkSheets[1].Cells[BeginRow, BeginCol];
 // Правая нижняя ячейка области, в которую будем выводить данные
   Cell2 := WorkBook.WorkSheets[1].Cells[BeginRow + RowCount - 1, BeginCol + ColCount - 1];

 // Область, в которую будем выводить данные
   Range := WorkBook.WorkSheets[1].Range[Cell1, Cell2];

 // А вот и сам вывод данных
 // Намного быстрее поячеечного присвоения
   Range.Value := ArrayData;

 // Делаем Excel видимым
   ExcelApp.Visible := True;
   ADOQuery1.First;
End;

end.

